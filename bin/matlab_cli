#!/bin/bash 

. $HOME/bin/error_utils

usage()
{
cat << _EOF_
Usage: $(basename $0) [--help] [--jvm] [--run "COMMAND"|"SCRIPT.m"]

Starts MATLAB interpreter without GUI.

Command is executed during startup and script is executed then exit.
Default is disabled Java Virtual Machine.
_EOF_
}

# Default options
deskcmd="-nodesktop -nosplash"
jvmcmd="-nodisplay -nojvm"
runcmd=

# Get command line options 
while [ "$1" ]; do 
    case "$1" in 
        -h | --help)
            usage
            exit 0
            ;;
        -j | --jvm)
            jvmcmd=
            shift
            ;;
        -r | --run)
            if [ "${2##*.}" = "m" ]; then
                # Script
                runcmd="-r \"try, run('$2'); catch me, fprintf(2, '%s / %s\\n', me.identifier, me.message); exit(1); end, exit(0);\""
            else
                # Command
                runcmd="-r \"try, $2, catch me, fprintf(2, '%s / %s\\n', me.identifier, me.message); exit(1); end\""
            fi
            shift 2
            ;;
        *)
            usage
            error_msg "invalid command line option, $1" 1
            ;;
    esac
done

# Run 
matlab "$deskcmd" "$jvmcmd" "$runcmd"

exit 0

