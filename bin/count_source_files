#!/bin/bash

usage()
{
    echo
    echo "Usage: $(basename $0) [--help] [--recursive] [--workdir \"WORKDIR\"] \".EXT1\" [\".EXT2\"] ..."
    echo
    echo "Count files that match given extension."
    echo
    echo "Default working directory is current directory."
    echo "Default is to not recurse directories."
    echo "Hidden files are ignored."
    echo
}

# Default options
recursive=
workdir="."
filext=()

# Get command line options 
while [ "$1" ]; do 
    case "$1" in 
        -h | --help)
        usage
        exit 0
        ;;
        -r | --recursive)
        recursive="-R"
        shift 1
        ;;
        -w | --workdir)
        workdir="$2"
        shift 2
        ;; 
        *)
        filext+=("$(echo "$1" | sed 's/\./\\\./g')")
        shift 1
        ;;
    esac
done

# Validate
if [ ! -d $workdir ]; then
    echo "Error: working directory does not exists."
    exit 1
fi

if [ ${#filext[@]} -eq 0 ]; then
    echo "Error: no file extensions were provided."
    exit 1
fi

# Change to file directory
pushd . > /dev/null 2>&1
cd "$workdir"

# List files recursively, ignore hidden files
# Filter source files and count
file_regex=$(IFS="|"; echo "${filext[*]}")
file_list=($(ls -1 "$recursive" | grep -E ".+($file_regex)$"))
num_files=${#file_list[@]}
echo "Number of matched files: $num_files"

# Change to initial directory
popd . > /dev/null 2>&1

exit 0

