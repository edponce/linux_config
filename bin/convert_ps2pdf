#!/bin/bash 

usage()
{
    echo
    echo "Usage: $(basename $0) [--help] [--outdir OUTDIR] PSFILE1 [PSFILE2] ..."
    echo
    echo "Convert PostScript files into PDF format."
    echo
    echo "If a PostScript file is not provided, current directory is searched for all."
    echo "Default output files are placed in current directory."
    echo
}

# Default options
outdir=
psfile=()

# Get command line options
while [ "$1" ]; do 
    case "$1" in 
        -h | --help)
            usage
            exit 0
            ;;
        -o | --outdir)
            OUTDIR="$2"
            shift 2
            ;;
        *)
            PSFILE+="$1 "
            shift
            ;;
    esac
done

# Validate output directory
[ -z "$OUTDIR" ] && OUTDIR="."
[ ! -d "$OUTDIR" ] && mkdir $OUTDIR

# Validate SAS file
if [ -z "$PSFILE" ]; then
    PSFILE=`ls | grep ".*\.ps$"`
    NUMFILES=`ls | grep ".*\.ps$" | wc -l`
    if [ $NUMFILES -eq 0 ]; then
        echo "Warning: no automatic PS file found, '$PSFILE'."
        exit 1
    else
        echo "Automatic PS file found, '$PSFILE'."
    fi
fi

# Iterate through all PS files
for each in $PSFILE; do 
    if [ ! -e $each ]; then
        echo "Error: PS file does not exists, '$each'."
        continue 
    fi

    CURRFILE=$(basename $each)
    BASEFILE=${CURRFILE%.*}
    PDFFILE=${BASEFILE}.pdf

    # Run command to convert file
    ps2eps --force --ignoreBB --rotate=+ $each
    epstopdf --outfile=${OUTDIR}/${BASEFILE}.pdf ${BASEFILE}.eps
    rm ${BASEFILE}.eps
done

exit 0

