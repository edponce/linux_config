#!/bin/bash

usage()
{
    echo
    echo "Usage: $(basename $0) [--help] [--delay DELAY] command"
    echo
    echo "Launch a terminal session and run command automatically."
    echo "The command can be delayed to allow terminal startup."
    echo "Delay values are in seconds [0-5] (default is 0.5)"
    echo
}

# Default
cmd=
delay=0.5

# Get command line options
while [ "$1" ]; do
    case "$1" in
        -h | --help)
        usage
        exit 0
        ;;
        -d | --delay)
        delay=$2
        shift 2
        ;;
        *)
        cmd="$@"
        shift $# 
        ;;
    esac
done

# Validate
if [ -z "$cmd" ]; then
    echo "Error: no command was specified."
    exit 1
fi

if [ $(bc -l <<< "if ($delay < 0 || $delay > 5) 1 else 0") -eq 1 ]; then
    echo "Error: invalid delay value."
    exit 1
fi

# app [args] 
which $(echo "$cmd" | awk '{ print $1}') > /dev/null
if [ $? -ne 0 ]; then
    echo "Error: command '$cmd' was not found."
    exit 1
fi

# Launch terminal and wait
lxterminal
sleep $delay

# Type and run command
xdotool type "$cmd"
xdotool key Return

unset cmd

