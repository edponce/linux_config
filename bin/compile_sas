#!/bin/bash 

usage()
{
    echo
    echo "Usage: $(basename $0) [--help] [--file \"SASFILE\"] [SASOPT1] [SASOPTION2] ..."
    echo
    echo "Run SAS script."
    echo
    echo "If a SAS file is not provided, current directory is searched for one."
    echo "All other arguments are passed directly to SAS command line."
    echo
}

# Default options
sasffile=
sasopts=
filext=".sas"

# Get command line options
while [ "$1" ]; do 
    case "$1" in 
        -h | --help)
        usage
        exit 0
        ;;
        -f | --file)
        sasffile="$2"
        shift 2
        ;;
        *)
        sasopts+="$sasopts $1"
        shift 1
        ;;
    esac
done

# Validate
if [ -z "$sasffile" ]; then
    . common_utils
    find_file_ext "$filext" 
    [ $? -ne 0 ] && exit 1
    sasffile="$file_list"
elif [ ! -e "$sasffile" ]; then
    echo "Error: file '$sasffile' does not exists."
    exit 1
fi

# Commands (compile) 
sasdir="$(dirname $sasffile)"
sasfile="$(basename $sasffile)"
sas_cmd="sas -nonews $sasopts $sasfile"

# Change to file directory
pushd . > /dev/null 2>&1
cd "$sasdir"

# Run
$sas_cmd

# Change to initial directory
popd > /dev/null 2>&1

exit 0

