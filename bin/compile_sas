#!/bin/bash 

. $HOME/bin/error_utils
. $HOME/bin/common_utils

usage()
{
cat << _EOF_

Usage: $(basename $0) [--help] [--file "SASFILE"] [SASOPTIONS]

Run SAS script.

If a SAS file is not provided, current directory is searched for one.
All other arguments are passed directly to SAS command line.

_EOF_
}

# Default options
sasffile=
sasopts=
filext=".sas"

# Get command line options
while [ "$1" ]; do 
    case "$1" in 
        -h | --help)
            usage
            exit 0
            ;;
        -f | --file)
            sasffile="$2"
            shift 2
            ;;
        *)
            sasopts+="$sasopts $1"
            shift
            ;;
    esac
done

# Validate
if [ -z "$sasffile" ]; then
    find_file_ext "$filext" 
    [ $? -eq 0 ] || exit 1
    sasffile="$file_list"
fi
if [ ! -e "$sasffile" ]; then
    error_msg "file '$sasffile' does not exists" 1
fi

# Commands (compile) 
sasdir="$(dirname $sasffile)"
sasfile="$(basename $sasffile)"
sas_cmd="sas -nonews $sasopts $sasfile"

# Change to file directory
pushd . > /dev/null 2>&1
cd "$sasdir"

# Run
$sas_cmd

# Change to initial directory
popd > /dev/null 2>&1

exit 0

